<!DOCTYPE html>
<html lang="en">
<head>
<title>Parametric Graphing Utility</title>
<style>
html,body { width: 100%; height: 100%; margin: 0px; }
form, input, p { font-family: consolas, monospace; font-size: 12pt; }
form { 
	position: fixed;
	bottom: 20px;
	left: 20px;
	border: 1px solid black;
	background-color: white;
	padding: 10px;
}
input { padding: 5px; width: 300px; margin: 5px auto; }
#error { position: fixed; bottom: 10px; right: 20px; color: red; }
canvas { margin-left: 5px; margin-top: 5px; }
</style>
<script type="text/javascript" src="parse_equation.js"></script>
<script>
var error;
var graphX, x_val, graphY, y_val;
var minBoundX, maxBoundX;
var minBoundY, maxBoundY;
var equation;
var tUnits = 1000;
var pixelsPerUnit = 20;
var segmentsPerUnit = 5;

var canvas, ctx;

function resize() { canvas.width = window.innerWidth - 10; canvas.height = window.innerHeight - 10; }

function graphSetup() {
	canvas = document.querySelector("canvas");
	ctx = canvas.getContext('2d');
	resize();

	error = document.querySelector('#error');
	
	maxBoundX = 100; minBoundX = -maxBoundX;
	maxBoundY = 100; minBoundY = -maxBoundY;
	graphX = document.querySelector("#x_eq");
	graphY = document.querySelector("#y_eq");
	graphX.onchange = updateEquation;
	graphY.onchange = updateEquation;
	equation = {};
	updateEquation();
}

function parseEquations(x_eq, y_eq) {
	if(x_val != x_eq) {
		x_val = x_eq;
		equation.x = parseEquation(x_eq);
		if(!equation.x) {
			error.innerHTML = errString;
			return;
		}
		else
			error.innerHTML = '';
	}
	if(y_val != y_eq) {
		y_val = y_eq;
		equation.y = parseEquation(y_eq);
		if(!equation.y) {
			error.innerHTML = errString;
			return;
		}
		else
			error.innerHTML = '';
	}
} 

function updateEquation() { 
	parseEquations(graphX.value, graphY.value); 
	graphDraw();
}

function drawT(t,tn) {
	var tx = equation.x.evaluate(t) * pixelsPerUnit
	  , ty = equation.y.evaluate(t) * pixelsPerUnit;
	if(Number.isNaN(tx) || Number.isNaN(ty))
		return;
	var bigNum = Number.MAX_VALUE;
	!Number.isFinite(tx) && (tx = Math.sign(tx) * bigNum);
	!Number.isFinite(ty) && (ty = Math.sign(ty) * bigNum);
	
	var txn = equation.x.evaluate(tn) * pixelsPerUnit
	  , tyn = equation.y.evaluate(tn) * pixelsPerUnit;
	(Number.isNaN(txn) && (txn = tx)) || 
	(!Number.isFinite(txn) && (txn = Math.sign(txn) * bigNum));
	(Number.isNaN(tyn) && (tyn = ty)) || 
	(!Number.isFinite(tyn) && (tyn = Math.sign(tyn) * bigNum));
	
	ctx.moveTo(tx, -ty);
	ctx.lineTo(txn,-tyn);
}

function graphDraw() {
	ctx.clearRect(0,0,canvas.width,canvas.height);
	ctx.beginPath();
	ctx.moveTo(0, canvas.height / 2);
	ctx.lineTo(canvas.width, canvas.height / 2);
	ctx.stroke();
	ctx.moveTo(canvas.width / 2, 0);
	ctx.lineTo(canvas.width / 2, canvas.height);
	ctx.stroke();
	
	ctx.save();
	ctx.translate(canvas.width/2,canvas.height/2);
	
	var unitsPerMarker = 1;
	for(var notches = canvas.width / pixelsPerUnit / unitsPerMarker, i = 0; i < notches; i++) {
		var pos = canvas.width * i / notches;
		ctx.moveTo(pos,-5); ctx.lineTo(pos,5); ctx.stroke();
		ctx.moveTo(-pos,-5); ctx.lineTo(-pos,5); ctx.stroke();
	}
	for(var notches = canvas.height / pixelsPerUnit / unitsPerMarker, i = 0; i < notches; i++) {
		var pos = canvas.height * i / notches;
		ctx.moveTo(-5,pos); ctx.lineTo(5,pos); ctx.stroke();
		ctx.moveTo(-5,-pos); ctx.lineTo(5,-pos); ctx.stroke();
	}
	if(equation.x && equation.y) {
		var tUpS = 1 / segmentsPerUnit;
		for(var t = 0.000001, end = tUnits - tUpS; t < end; t += tUpS) {
			drawT(t,(t+tUpS));
		}
		ctx.stroke();
		for(var t = 0.000001, end = tUnits - tUpS; t < end; t += tUpS) {
			drawT(-t,-(t+tUpS));
		}
		ctx.stroke();
	}	
	ctx.restore();
}

window.onload = graphSetup;
window.onresize = function() { resize(); graphDraw(); };
</script>

</head>
<body>
<canvas></canvas>
<form>
X = <input type="text" id="x_eq" value="5*(3.1*(cos(t))-cos(3.1t))"><br>
Y = <input type="text" id="y_eq" value="5*(3.1*(sin(t))-sin(3.1t))">
</form>
<p id="error"></p>
</body>
</html>